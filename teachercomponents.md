Architecture Blueprint: Shape of the Day (Privacy Edition)
1. Technology Stack & Package Requirements
Core Environment
Runtime: Node.js (v20+ Recommended)

Framework: React 18 (Vite Build Tool)

Language: TypeScript 5.0+ (Strict Type Safety mandated for Data Models)

Backend: Firebase (Firestore, Auth, Hosting, Cloud Functions)

Essential Software Packages (Node Modules)
Run this install command to initialize the feature set:

Bash

npm install react-router-dom lucide-react qrcode.react recharts date-fns uuid framer-motion zustand firebase
react-router-dom: Handles the split between /teacher/dashboard, /student/join, and /teacher/analytics.

qrcode.react: Specifically for rendering the SVG QR code in the Teacher Sidebar without calling an external API (security/speed).

recharts: The industry standard for React data visualization (needed for the Analytics tab).

lucide-react: Lightweight, clean icons for the Sidebar (Menu, User, QR) and Status indicators.

date-fns: Essential for calculating the "Time to Complete" (End Time - Start Time) logic.

uuid: For generating ephemeral session IDs if Auth UID isn't available.

framer-motion: For the smooth slide-out animation of the QR Sidebar.

zustand: State management to hold the "Current Class Session" data globally without prop-drilling.

2. The Data Lifecycle (Privacy Architecture)
This is the most critical logic block. We are implementing a "Use & Destroy" data policy for PII (Personally Identifiable Information), while retaining "Scrubbed" data for analytics.

Phase A: Static Configuration
Stored in classrooms collection.

Persistence: Forever.

Fields: code (Static, e.g., "7X99L"), teacherId, name, contentLibrary (The list of available tasks).

Phase B: The Live Session (Ephemeral)
Stored in classrooms/{classId}/live_sessions/{sessionId}/students.

Persistence: Temporary. Exists ONLY while the tab is open.

Fields: displayName (The Name), currentStatus, realTimeProgress.

Logic: When this document is deleted, the link between the "Name" and the "Data" is severed forever.

Phase C: The Analytics Vault (Persistent)
Stored in analytics_logs.

Persistence: Forever.

Fields: NO NAMES. Only taskDurations, questionsAsked, stuckPoints.

Logic: This data is generated by "harvesting" Phase B data immediately before Phase B data is deleted.

3. Detailed Component Nodes
Node 1: The "Connection Sidebar" (Teacher View)
File: src/components/teacher/ConnectionSidebar.tsx

UI Specification:

Container: fixed right-0 top-0 h-full bg-white shadow-2xl z-50 transition-width.

Collapsed State (Width: 60px):

Top: <QrCodeIcon /> (Lucide).

Middle: Text rotated 90deg displaying the 6-char classCode.

Bottom: <UsersIcon /> with a red badge showing liveStudents.length.

Trigger: onClick={() => setIsExpanded(true)}.

Expanded State (Width: 350px):

Header:

Component: <QRCodeSVG value={https://www.google.com/search?q=https://app.com/join/${classCode}} size={200} />.

Text: "Join Code: {classCode}".

Button: "Copy Link".

Roster List (Scrollable):

Iterate through live_students collection.

Row Layout: [Avatar/Initial] [DisplayName] [Current Status Icon].

Footer:

Close Button (Arrow Right).

Integration Logic:

Use a Firestore onSnapshot listener on the live_students collection.

Pass the student count to the collapsed badge in real-time.

Node 2: Student Login & Session Initialization
File: src/pages/student/JoinClass.tsx

The Workflow:

URL Param Check: Does useParams() contain a code?

Yes: Auto-fill the "Class Code" input.

No: Show empty input.

Input Form:

Field 1: Class Code (Validation: Must exist in DB).

Field 2: "Who are you today?" (Display Name).

The "Join" Action (Crucial Step):

Step A: Authenticate Anonymously via Firebase Auth (signInAnonymously). Use the resulting uid as the document key.

Step B: Write to live_students doc:

TypeScript

{
   displayName: "Sarah", // Only exists here
   joinedAt: serverTimestamp(),
   metrics: {
       tasksCompleted: 0,
       activeTasks: []
   }
}
Step C: Set sessionStorage item currentClassId.

Node 3: The "Scrubbing" Logic (Analytics Generation)
File: src/utils/analyticsScrubber.ts

This function is triggered when a student clicks "Sign Out" OR when the Teacher clicks "End Class".

TypeScript

export const scrubAndSaveSession = async (studentId, classId, liveData) => {
    // 1. Prepare the Anonymous Analytics Payload
    const analyticsPayload = {
        classroomId: classId,
        date: new Date().toISOString().split('T')[0], // YYYY-MM-DD
        sessionDuration: Date.now() - liveData.joinedAt.toMillis(),
        
        // MAP the tasks, stripping identifying info
        taskPerformance: liveData.taskHistory.map(task => ({
            taskId: task.id,
            title: task.title,
            timeToComplete_ms: task.completedAt - task.startedAt, // Calculate Duration
            statusWasStuck: task.wasStuck, // Boolean
            questionsAsked: task.questions // Array of strings
        }))
    };

    // 2. Write to Permanent Analytics Collection
    await addDoc(collection(db, 'analytics_logs'), analyticsPayload);

    // 3. DELETE the Live Data (Privacy Enforcement)
    await deleteDoc(doc(db, `classrooms/${classId}/live_students/${studentId}`));
};
4. The Analytics Dashboard Tab
File: src/pages/teacher/AnalyticsDashboard.tsx

Layout: Three-Pane Grid.

Pane A: "Time on Task" (Bar Chart)
Goal: Show how long tasks actually took vs. estimated.

Component: Recharts.BarChart.

Data Prep: Query analytics_logs for today. Group by taskId. Calculate average timeToComplete_ms.

X-Axis: Task Title.

Y-Axis: Minutes.

Pane B: "The Friction Log" (List View)
Goal: Read anonymous questions to improve future teaching.

UI: A list of cards.

Data Source: Flatten the questionsAsked arrays from all anonymous logs.

Display:

Icon: Question Mark.

Text: "I don't understand what a denominator is."

Context: "Asked during: Math Worksheet A".

Timestamp: "10:42 AM".

Pane C: "Class Pulse" (Pie Chart)
Goal: High-level success rate.

Component: Recharts.PieChart.

Segments:

Green: Smooth Sailing (No stuck states).

Yellow: Minor Friction (Briefly stuck).

Red: High Friction (Asked questions / never finished).

5. Development Extensions & Implementation Order
Database Security Rules (Firestore):

Set rules so live_students can ONLY be read by the Teacher and the specific creator (student).

Set rules so analytics_logs is write-only for students (they can drop data in, but never read it back) and read-only for teachers.

QR Code Implementation Detail:

Install qrcode.react.

Inside the Sidebar component:

JavaScript

<div className="bg-white p-4 rounded-lg">
   <QRCodeSVG 
       value={`https://myschoolapp.com/join?code=${classData.code}`} 
       size={256}
       level={"H"} // High error correction
       includeMargin={true}
   />
</div>
Handling "Tab Close" (Edge Case):

If a student closes the browser without clicking "Sign Out", the "Scrub" function won't run on the client.

Solution: Use a Firebase Cloud Function (Scheduled).

Logic: Every 60 minutes, check live_students. If lastActive > 2 hours ago, run the Scrub function server-side and delete the doc.